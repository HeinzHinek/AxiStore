{% extends "base.html" %}
{% block content %}

<script>
    $(document).ready( function() {
        $('#year-select').val( {{ curr_year }} );
        $('#month-select').val( {{ curr_month }} );

        $('#month-select').change( function() {
            date_change_check();
        });
        $('#year-select').change( function() {
            date_change_check();
        });

        $('#date-set-btn').click( function() {
            window.location.replace("{{ url_for('recommendedshares') }}" + "/{{ curr_id }}"
                + "?curr_year=" + $( '#year-select option:selected' ).val()
                + "&curr_month=" + $( '#month-select option:selected' ).val())
        });
    });

    function date_change_check() {
        if ($('#year-select').val() != {{ curr_year }} || $('#month-select').val() != {{ curr_month }} ) {
            $('#date-set-btn').show('fast');
        } else {
            $('#date-set-btn').hide('fast');
        }
    }
</script>

<div class="row">
    <h2>{{ _("Sales of Recommended Customers") }}</h2>
    {% include 'flash.html' %}
</div>

<div class="row">
{% if customers_with_recommended %}

    <table>
        <tr>
            <td style="padding: 5px 10px;">
                <h4>{{ _('Select customer') }}:</h4>
            </td>
            <td style="padding: 5px 10px 5px 20px;">
                <h4>{{ _('Select year and month') }}:</h4>
            </td>
        </tr>
        <tr>
            <td style="padding: 5px 10px; vertical-align: top;">
                <div class="list-group">
                    {% for customer in customers_with_recommended %}
                        <a href="{{ url_for('recommendedshares', id=customer.id, curr_year=curr_year, curr_month=curr_month) }}" style="padding: 5px 10px;"
                           class="list-group-item small {% if curr_id == customer.id %}active{% endif %}">
                           {{ customer.name }}
                        </a>
                    {% endfor %}
                </div>
            </td>
            <td style="padding: 5px 10px 5px 20px; vertical-align: top;">
                <select id="year-select" class="form-control input-sm">
                    {% for i in range(this_year - 2013) %}
                    <option value="{{ i + 2014 }}">{{ i + 2014 }}</option>
                    {% endfor %}
                </select>
                <select id="month-select" class="form-control input-sm">
                    <option value="1">{{ _('January') }}</option>
                    <option value="2">{{ _('February') }}</option>
                    <option value="3">{{ _('March') }}</option>
                    <option value="4">{{ _('April') }}</option>
                    <option value="5">{{ _('May') }}</option>
                    <option value="6">{{ _('June') }}</option>
                    <option value="7">{{ _('July') }}</option>
                    <option value="8">{{ _('August') }}</option>
                    <option value="9">{{ _('September') }}</option>
                    <option value="10">{{ _('October') }}</option>
                    <option value="11">{{ _('November') }}</option>
                    <option value="12">{{ _('December') }}</option>
                </select>
                <input type="button" id="date-set-btn" value="{{ _('Set') }}" class="btn btn-sm btn-info" style="display: none; float: right;"/>
            </td>
        </tr>
    </table>
{% endif %}
</div>

<div class="row">
{% if customers_with_recommended %}
    <table class="table table-striped table-bordered table-hover table-condensed" style="border: 2px solid #bbbbbb;">
        <tr>
            <th style="border-bottom: 2px solid #bbbbbb;">{{ _('Recommended Customer') }}</th>
            <th style="text-align: right; border-bottom: 2px solid #bbbbbb;">{{ _('Requested products value') }}
            <th style="text-align: right; border-bottom: 2px solid #bbbbbb;">{{ _('Supplied products value') }}</th>
        </tr>

        {% if recommended %}
        {% for cust in recommended %}
        <tr>
            <td>{{ cust.name }}</td>
            <td style="text-align: right;">{{ cust.requested_value }}</td>
            <td style="text-align: right;">{{ cust.supplied_value }}</td>
        </tr>
        {% endfor %}
        {% endif %}
        <tr style="background-color: transparent !important;" class="alert-info">
            <th style="text-align: right; border-top: 2px solid #bbbbbb;">{{ _('Total:') }}</th>
            <th style="text-align: right; border-top: 2px solid #bbbbbb;">{{ sum_request_values }}</th>
            <th style="text-align: right; border-top: 2px solid #bbbbbb;">{{ sum_supply_values }}</th>
        </tr>
        <tr style="background-color: transparent !important;" class="alert-success">
            <th style="text-align: right;">{{ (base_share * 100) }}% {{ _('Share:') }}</th>
            <th style="text-align: right;">{{ sum_request_values * base_share }}</th>
            <th style="text-align: right;">{{ sum_supply_values * base_share }}</th>
        </tr>
    </table>
{% else %}
    <h4>{{ _('No recommended customers found.') }}</h4>
{% endif %}
</div>

{% endblock %}